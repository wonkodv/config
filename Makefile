default:
	echo "use make install"

install: generated/bashrc generated/bash_profile
	ln -i -s $(PWD)/generated/bashrc ~/.bashrc              || true
	ln -i -s $(PWD)/generated/bash_profile ~/.bash_profile  || true
	ln -i -s $(PWD)/gitconfig ~/.gitconfig                  || true
	mkdir -p ~/.config/nix
	ln -i -s $(PWD)/nix.conf ~/.config/nix/nix.conf         || true
	ln -i -s $(PWD)/nvim ~/.config/nvim                     || true
	touch ~/.bashrc_local
	touch ~/.bash_profile_local

generated/%:
	mkdir -p generated
	{ echo "### Generated by $(PWD)/Makefile";                 \
		for f in $(@F).d/*.bash ;                              \
		do                                                     \
			echo "source $(PWD)/$$f";                          \
		done ;                                                 \
	}  > $@

clean:
	rm -rf generated/

.PHONY: clean install default diff
